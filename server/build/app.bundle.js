(()=>{var e={594:(e,t,r)=>{function n(e,t,r,n,o,s,u){try{var i=e[s](u),c=i.value}catch(a){return void r(a)}i.done?t(c):Promise.resolve(c).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var u=e.apply(t,r);function i(e){n(u,o,s,i,c,"next",e)}function c(e){n(u,o,s,i,c,"throw",e)}i(void 0)}))}}r(278),r(389),r(757),r(82),r(720),r(647),r(381),r(24),r(718),r(536);var s=r(966),u=r(746),i=r(669),c=r(853),a=r(200);s.setVapidDetails("mailto:example@domain.com",process.env.VAPID_PUBLIC_KEY,process.env.VAPID_PRIVATE_KEY);var p=function(){var e=o(regeneratorRuntime.mark((function e(t,r,n){var o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.find({});case 3:o=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),s=new a("Something went wrong, could not find posts.",500),e.abrupt("return",n(s));case 10:if(o){e.next=13;break}return u=new a("Could not find posts.",404),e.abrupt("return",n(u));case 13:o.sort((function(e,t){return new Date(e.createdAt)-new Date(t.createdAt)})),r.json({posts:o.map((function(e){return e.toObject({getters:!0})}))});case 15:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r,n){return e.apply(this,arguments)}}(),l=function(){var e=o(regeneratorRuntime.mark((function e(t,r,n){var o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.params.pId,e.prev=1,e.next=4,i.findById(o);case 4:s=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),u=new a("Something went wrong, could not find post.",500),e.abrupt("return",n(u));case 11:if(s){e.next=14;break}return c=new a("Could not find post.",404),e.abrupt("return",n(c));case 14:r.json({post:s.toObject({getters:!0})});case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r,n){return e.apply(this,arguments)}}(),f=function(){var e=o(regeneratorRuntime.mark((function e(t,r,n){var p,l,f,d,m,v,y,g,x,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=t.body,l=p.title,f=p.location,d=p.rawLocationLat,m=p.rawLocationLng,v=new i({title:l,location:f,image:u(t.file.path),rawLocation:{lat:d,lng:m}}),e.prev=2,e.next=5,v.save();case 5:return e.next=7,c.find({});case 7:y=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(2),g=new a("Creating post failed, please try again.",500),e.abrupt("return",n(g));case 14:if(y){e.next=17;break}return x=new a("Could not find subscriptions.",404),e.abrupt("return",n(x));case 17:return e.prev=17,e.next=20,Promise.all(y.map(function(){var e=o(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={endpoint:t.endpoint,keys:{auth:t.keys.auth,p256dh:t.keys.p256dh}},e.next=3,s.sendNotification(r,JSON.stringify({title:"New Post!",content:"New Post added!",openUrl:"/help"}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:e.next=26;break;case 22:return e.prev=22,e.t1=e.catch(17),j=new a("Failed to send the notification.",500),e.abrupt("return",n(j));case 26:r.status(201).json({post:v.toObject({getters:!0})});case 27:case"end":return e.stop()}}),e,null,[[2,10],[17,22]])})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports={getPosts:p,getPostById:l,createPost:f}},892:(e,t,r)=>{function n(e,t,r,n,o,s,u){try{var i=e[s](u),c=i.value}catch(a){return void r(a)}i.done?t(c):Promise.resolve(c).then(n,o)}r(278),r(647),r(381),r(536),r(24);var o=r(853),s=r(200),u=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,r,n){var u,i,c,a,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.body,i=u.endpoint,c=u.keys,a=new o({endpoint:i,keys:c}),e.prev=2,e.next=5,a.save();case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),p=new s("Creating subscription failed, please try again.",500),e.abrupt("return",n(p));case 11:r.status(201).json({subscription:a.toObject({getters:!0})});case 12:case"end":return e.stop()}}),e,null,[[2,7]])})),function(){var t=this,r=arguments;return new Promise((function(o,s){var u=e.apply(t,r);function i(e){n(u,o,s,i,c,"next",e)}function c(e){n(u,o,s,i,c,"throw",e)}i(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}();e.exports={createSubscription:u}},340:(e,t,r)=>{var n=r(633),o=r(231).v4,s={"image/png":"png","image/jpeg":"png","image/jpg":"jpg"},u=n.diskStorage({destination:function(e,t,r){r(null,"uploads/images")},filename:function(e,t,r){var n=s[t.mimetype];r(null,o()+"."+n)}}),i=n({limits:5e5,storage:u,fileFilter:function(e,t,r){var n=!!s[t.mimetype];r(n?null:new Error("Invalid mime type!"),n)}});e.exports=i},200:(e,t,r)=>{function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){var t="function"===typeof Map?new Map:void 0;return(s=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)})(e)}function u(e,t,r){return(u=i()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&c(o,r.prototype),o}).apply(null,arguments)}function i(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r(890),r(785),r(946),r(82),r(381),r(655),r(646),r(708),r(647),r(468),r(718),r(536),r(280),r(920),r(350),r(507);var p=function(e){"use strict";!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,e);var t=function(e){var t=i();return function(){var r,n=a(e);if(t){var s=a(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return o(this,r)}}(r);function r(e,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(o=t.call(this,e)).code=n,o}return r}(s(Error));e.exports=p},669:(e,t,r)=>{r(99);var n=r(619),o=new(0,n.Schema)({title:{type:String,required:!0},location:{type:String,required:!0},image:{type:String,required:!0},rawLocation:{lat:{type:Number,required:!0},lng:{type:Number,required:!0}}},{timestamps:!0});e.exports=n.model("Post",o)},853:(e,t,r)=>{var n=r(619),o=new(0,n.Schema)({endpoint:{type:String,required:!0},keys:{auth:{type:String,required:!0},p256dh:{type:String,required:!0}}});e.exports=n.model("Subscription",o)},122:(e,t,r)=>{var n=r(127),o=r(594),s=r(340),u=n.Router();u.get("/",o.getPosts),u.get("/:pId",o.getPostById),u.post("/",s.single("image"),o.createPost),e.exports=u},414:(e,t,r)=>{var n=r(127),o=r(892),s=n.Router();s.post("/",o.createSubscription),e.exports=s},473:e=>{"use strict";e.exports=require("body-parser")},794:e=>{"use strict";e.exports=require("core-js/modules/es.array.concat.js")},389:e=>{"use strict";e.exports=require("core-js/modules/es.array.find.js")},946:e=>{"use strict";e.exports=require("core-js/modules/es.array.index-of.js")},647:e=>{"use strict";e.exports=require("core-js/modules/es.array.iterator.js")},983:e=>{"use strict";e.exports=require("core-js/modules/es.array.join.js")},720:e=>{"use strict";e.exports=require("core-js/modules/es.array.map.js")},757:e=>{"use strict";e.exports=require("core-js/modules/es.array.sort.js")},82:e=>{"use strict";e.exports=require("core-js/modules/es.date.to-string.js")},708:e=>{"use strict";e.exports=require("core-js/modules/es.function.bind.js")},468:e=>{"use strict";e.exports=require("core-js/modules/es.map.js")},99:e=>{"use strict";e.exports=require("core-js/modules/es.number.constructor.js")},280:e=>{"use strict";e.exports=require("core-js/modules/es.object.create.js")},785:e=>{"use strict";e.exports=require("core-js/modules/es.object.get-prototype-of.js")},890:e=>{"use strict";e.exports=require("core-js/modules/es.object.set-prototype-of.js")},381:e=>{"use strict";e.exports=require("core-js/modules/es.object.to-string.js")},24:e=>{"use strict";e.exports=require("core-js/modules/es.promise.js")},646:e=>{"use strict";e.exports=require("core-js/modules/es.reflect.construct.js")},655:e=>{"use strict";e.exports=require("core-js/modules/es.regexp.to-string.js")},718:e=>{"use strict";e.exports=require("core-js/modules/es.string.iterator.js")},350:e=>{"use strict";e.exports=require("core-js/modules/es.symbol.description.js")},507:e=>{"use strict";e.exports=require("core-js/modules/es.symbol.iterator.js")},920:e=>{"use strict";e.exports=require("core-js/modules/es.symbol.js")},536:e=>{"use strict";e.exports=require("core-js/modules/web.dom-collections.iterator.js")},127:e=>{"use strict";e.exports=require("express")},747:e=>{"use strict";e.exports=require("fs")},619:e=>{"use strict";e.exports=require("mongoose")},633:e=>{"use strict";e.exports=require("multer")},746:e=>{"use strict";e.exports=require("normalize-path")},622:e=>{"use strict";e.exports=require("path")},278:e=>{"use strict";e.exports=require("regenerator-runtime/runtime.js")},231:e=>{"use strict";e.exports=require("uuid")},966:e=>{"use strict";e.exports=require("web-push")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}(()=>{function e(e,t,r,n,o,s,u){try{var i=e[s](u),c=i.value}catch(a){return void r(a)}i.done?t(c):Promise.resolve(c).then(n,o)}r(278),r(983),r(794),r(381),r(24);var t,n=r(747),o=r(622),s=r(127),u=r(473),i=r(619),c=r(122),a=r(414),p=r(200),l=s();l.use(u.json()),l.use("/uploads/images",s.static(o.join("uploads","images"))),l.use((function(e,t,r){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, Authorization"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, PATCH, DELETE"),r()})),l.use("/posts",c),l.use("/subscriptions",a),l.use((function(e,t,r){throw new p("Could not find this route.",404)})),l.use((function(e,t,r,o){if(t.file&&n.unlink(t.file.path,(function(e){})),r.headerSent)return o(e);r.status(e.code||500),r.json({message:e.message||"An unknown error occurred!"})})),(t=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.connect("mongodb+srv://".concat(process.env.DB_USER,":").concat(process.env.DB_PASSWORD,"@cluster0.rfhfl.mongodb.net/").concat(process.env.DB_NAME,"?retryWrites=true&w=majority"),{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0});case 3:t=process.env.PORT||8e3,l.listen(t,(function(){console.log("Server running!")})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var r=this,n=arguments;return new Promise((function(o,s){var u=t.apply(r,n);function i(t){e(u,o,s,i,c,"next",t)}function c(t){e(u,o,s,i,c,"throw",t)}i(void 0)}))})()})()})();